---
title: "test"
output: html_document
date: "2023-12-11"
---


```{r}
library(shiny)
library(ggplot2)
library(thematic)
library(ragg)
library(readr)
library(stringr)
library(shinydashboard)
library(leaflet)
library(plotly)
library(readxl)
library(tidyr)
library(sf)
library(dplyr)
library(geojsonio)

percent_drought_df <- read_excel("C:/Users/sweth/OneDrive/Desktop/project-final-Graph-Gurus/data/drought data.xlsx", sheet = "Percent Area by County")

arizona_counties <- arizona_counties %>%
  select(County, geometry)

percent_drought_df$County <- as.character(drought_df$County)
arizona_counties$County <- as.character(arizona_counties$County)
percent_drought_df$Date<- as.Date(percent_drought_df$Date)

drought_data_geospatial <- percent_drought_df %>%
  left_join(arizona_counties, by = "County")




```


```{r }

library(sf)
library(ggplot2)
library(dplyr)
library(tidyr)


# Define your fixed color palette
drought_colors <- c(
  "None" = "#FFFFFF", # Assuming 'None' is white
  "D0" = "#FFFF00", # Yellow
  "D1" = "#FFA500", # Orange
  "D2" = "#FF0000", # Red
  "D3" = "#8B0000", # Dark Red
  "D4" = "#654321"  # Brown
)


#Create a column for Droughtlevel
drought_data_geospatial <- drought_data_geospatial %>%
  mutate(
    Max_Value = pmax(None, D0, D1, D2, D3, D4, na.rm = TRUE),
    Drought_Level = case_when(
      None == Max_Value ~ "None",
      D0 == Max_Value ~ "D0",
      D1 == Max_Value ~ "D1",
      D2 == Max_Value ~ "D2",
      D3 == Max_Value ~ "D3",
      D4 == Max_Value ~ "D4",
      TRUE ~ NA_character_  
    )
  )

#Drop Max_Value
drought_data_geospatial$Max_Value <- NULL

dates_of_interest <- as.Date(c("2005-04-26 UTC"))

drought_data_geospatial$Date <- as.Date(drought_data_geospatial$Date)

drought_data_filtered <- drought_data_geospatial %>%
  filter(Date %in% dates_of_interest)

drought_data_joined <- arizona_counties %>%
  left_join(drought_data_filtered, by = "County")

#Drop columns
drought_data_joined[c("None", "D0", "D1", "D2","D3", "D4","geometry.y")] <- list(NULL)

#Rename
drought_data_joined <- drought_data_joined %>%
  rename(geometry = geometry.x)

#Convert to sf object
drought_data_joined <- st_as_sf(drought_data_joined, wkt = "geometry")

#Plot
library(ggplot2)
library(sf)



ggplot(data = drought_data_joined) +
  geom_sf(aes(
    fill = drought_data_joined$Drought_Level), color = "blue", size = 0.2) + # Set county border color and size
  scale_fill_manual(values = drought_colors, name = "Drought Level") +
  labs(
    title = "Drought Levels in Arizona",
    caption = "Data source: XYZ"
  ) +
  theme_minimal() + # Set a minimal theme
  theme(legend.position = "right", # Adjust legend position
        plot.title = element_text(hjust = 0.5, size = 14), # Center and set the title size
        legend.text = element_text(size = 8), # Adjust legend text size
        legend.title = element_text(size = 10) # Adjust legend title size
  ) +
  guides(fill = guide_legend(title.position = "top", title.hjust = 0.5)) # Adjust legend guide
 






```
